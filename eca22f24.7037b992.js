(window.webpackJsonp=window.webpackJsonp||[]).push([[45],{100:function(e,t,n){"use strict";n.r(t),n.d(t,"frontMatter",(function(){return i})),n.d(t,"metadata",(function(){return s})),n.d(t,"rightToc",(function(){return c})),n.d(t,"default",(function(){return l}));var r=n(2),o=n(6),a=(n(0),n(106)),i={id:"forms",title:"Forms"},s={unversionedId:"guides/forms",id:"guides/forms",isDocsHomePage:!1,title:"Forms",description:"Authenticity Tokens",source:"@site/docs/guides/forms.mdx",slug:"/guides/forms",permalink:"/homeflowjs-docs/docs/guides/forms",editUrl:"https://github.com/homeflow/homeflowjs-docs/edit/master/docs/guides/forms.mdx",version:"current",sidebar:"someSidebar",previous:{title:"Routing",permalink:"/homeflowjs-docs/docs/guides/routing"},next:{title:"Cookie Consent",permalink:"/homeflowjs-docs/docs/guides/cookie-consent"}},c=[{value:"Authenticity Tokens",id:"authenticity-tokens",children:[]},{value:"Recaptcha",id:"recaptcha",children:[]}],u={rightToc:c};function l(e){var t=e.components,n=Object(o.a)(e,["components"]);return Object(a.b)("wrapper",Object(r.a)({},u,n,{components:t,mdxType:"MDXLayout"}),Object(a.b)("h2",{id:"authenticity-tokens"},"Authenticity Tokens"),Object(a.b)("p",null,"Form submissions on Homeflow websites are protected against ",Object(a.b)("a",Object(r.a)({parentName:"p"},{href:"https://en.wikipedia.org/wiki/Cross-site_request_forgery"}),"cross-site request forgery")," through the use of authenticity tokens."),Object(a.b)("p",null,"The server provides a token that is made available as a liquid variable, Homeflow config and Redux state:"),Object(a.b)("pre",null,Object(a.b)("code",Object(r.a)({parentName:"pre"},{}),"{{ form_authenticity_token }}\nHomeflow.get('authenticityToken');\nstore.getState().app.authenticityToken;\n")),Object(a.b)("p",null,"You should ensure this token is included in every form submission."),Object(a.b)("p",null,"If your form is a React component, provide the token to your form using ",Object(a.b)("inlineCode",{parentName:"p"},"mapStateToProps"),":"),Object(a.b)("pre",null,Object(a.b)("code",Object(r.a)({parentName:"pre"},{className:"language-jsx"}),"import React, { useState } from 'react';\nimport { connect } from 'react-redux';\n\nconst MyForm = ({ authenticityToken }) => {\n  const [email, setEmail] = useState('');\n\n  const handleSubmit = (e) => {\n    e.preventDefault();\n\n    fetch('/form_submissions', {\n      method: 'POST',\n      body: JSON.stringify({\n        form_submission: { email },\n        authenticity_token: authenticityToken,\n      }),\n    });\n  }\n\n  return (\n    <form onSubmit={handleSubmit}>\n      <h2>Sign up for our newsletter!</h2>\n\n      <input\n        name=\"email\"\n        value={email}\n        onChange={(e) => setEmail(e.target.value)}\n        placeholder=\"Email\"\n      />\n\n      <button type=\"submit\">Submit</button>\n    </form>\n  );\n};\n\nconst mapStateToProps = (state) => ({\n  authenticityToken: state.app.authenticityToken,\n});\n\nexport default connect(mapStateToProps)(MyForm)\n")),Object(a.b)("p",null,"If it's a regular HTML form in a liquid template, simply include the token using a hidden field:"),Object(a.b)("pre",null,Object(a.b)("code",Object(r.a)({parentName:"pre"},{className:"language-html"}),'<form action="/form_submissions">\n  <input type="hidden" name="authenticity_token" value="{{ form_authenticity_token }}" />\n\n  <input name="email" placeholder="email" />\n\n  <button type="submit">Submit</button>\n</form>\n')),Object(a.b)("h2",{id:"recaptcha"},"Recaptcha"),Object(a.b)("p",null,"If you need to prevent a form from submitting to handle validation, you will need to add the\n",Object(a.b)("inlineCode",{parentName:"p"},"hfjs-form-invalid")," class to your form. This is because Recaptcha will submit your form regardless of any\ncode stopping your form from submitting. The example bellow show you how to implement this. Remember\nyou will need to remove the ",Object(a.b)("inlineCode",{parentName:"p"},"hfjs-form-invalid"),"  when you go to submit the form (i.e if its passed validation)."),Object(a.b)("pre",null,Object(a.b)("code",Object(r.a)({parentName:"pre"},{className:"language-jsx"}),"import React, { useState } from 'react';\n\nconst ExampleForm = () => {\n  const [value, setValue] = useState('');\n  const [preventRecaptcha, setPreventRecaptcha] = useState(true);\n\n  const handleInputChange = e => setValue(e.target.value);\n\n  const handleSubmit = (e) => {\n    // If value is empty stop form form being submitted\n    if (value === '') {\n      e.preventDefault();\n      setPreventRecaptcha(true);\n      return;\n    }\n\n    /**\n     * If no errors remove class hfjs-form-invalid and submit\n     * form (as e.preventDefault() not called)\n     */\n    setPreventRecaptcha(false);\n  };\n\n  return (\n    <form\n      className={`${preventRecaptcha ? 'hfjs-form-invalid' : ''}`}\n      onSubmit={handleSubmit}\n    >\n      <input type=\"text\" value={value} onChange={handleInputChange} />\n      <input type=\"submit\" value=\"Submit\" />\n    </form>\n  );\n};\n\nexport default ExampleForm;\n")))}l.isMDXComponent=!0},106:function(e,t,n){"use strict";n.d(t,"a",(function(){return m})),n.d(t,"b",(function(){return d}));var r=n(0),o=n.n(r);function a(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function i(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function s(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?i(Object(n),!0).forEach((function(t){a(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):i(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function c(e,t){if(null==e)return{};var n,r,o=function(e,t){if(null==e)return{};var n,r,o={},a=Object.keys(e);for(r=0;r<a.length;r++)n=a[r],t.indexOf(n)>=0||(o[n]=e[n]);return o}(e,t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(r=0;r<a.length;r++)n=a[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(o[n]=e[n])}return o}var u=o.a.createContext({}),l=function(e){var t=o.a.useContext(u),n=t;return e&&(n="function"==typeof e?e(t):s(s({},t),e)),n},m=function(e){var t=l(e.components);return o.a.createElement(u.Provider,{value:t},e.children)},p={inlineCode:"code",wrapper:function(e){var t=e.children;return o.a.createElement(o.a.Fragment,{},t)}},f=o.a.forwardRef((function(e,t){var n=e.components,r=e.mdxType,a=e.originalType,i=e.parentName,u=c(e,["components","mdxType","originalType","parentName"]),m=l(n),f=r,d=m["".concat(i,".").concat(f)]||m[f]||p[f]||a;return n?o.a.createElement(d,s(s({ref:t},u),{},{components:n})):o.a.createElement(d,s({ref:t},u))}));function d(e,t){var n=arguments,r=t&&t.mdxType;if("string"==typeof e||r){var a=n.length,i=new Array(a);i[0]=f;var s={};for(var c in t)hasOwnProperty.call(t,c)&&(s[c]=t[c]);s.originalType=e,s.mdxType="string"==typeof e?e:r,i[1]=s;for(var u=2;u<a;u++)i[u]=n[u];return o.a.createElement.apply(null,i)}return o.a.createElement.apply(null,n)}f.displayName="MDXCreateElement"}}]);